<style type="text/css">
.nav-noti-popover {
  width: 200px;
  height: 240px;
}
.nav-noti-popover ul li {
  width: 33%;
  margin: 0;
  text-align: center;
}
</style>

<li>
  <a id="nav-noti-btn" href="#" onclick="javascript:;">
    消息
    <span class="badge"></span>
  </a>
  <div class="nav-noti-popover" hidden>
    <!-- Nav tabs -->
    <ul class="nav nav-pills">
      <li class="active"><a href="#nav-tab-content-noti" data-toggle="tab">
        <i class="fa fa-list"></i>
      </a></li>
      <li><a href="#nav-tab-content-follow" data-toggle="tab">
        <i class="fa fa-users"></i>
      </a></li>
      <li><a href="#nav-tab-content-like" data-toggle="tab">
        <i class="fa fa-heart"></i>
      </a></li>
    </ul>

    <!-- Tab panes -->
    <div class="tab-content">
      <div class="tab-pane active" id="nav-tab-content-noti">
        <div style="text-align: center;">
          <i class="fa fa-spinner fa-pulse"></i>
        </div>
      </div>
      <div class="tab-pane" id="nav-tab-content-follow">
        TODO: follow notifications list
      </div>
      <div class="tab-pane" id="nav-tab-content-like">
        TODO: like notifications list
      </div>
    </div>
  </div>
</li>
<script type="text/javascript">
  $(function() {
    var $navNotiBtn = $('#nav-noti-btn');
    var $notiCount = $navNotiBtn.find('.badge');
    
    // count badge
    var countNotification = function() {
      $.ajax({
        type: 'GET',
        url: '/api/Notifications/count?where={"is_read":false}',
      }).success(function(res) {
        var count = res.count;
        if(count) {
          $notiCount.text(count);
        } else {
          $notiCount.text('');
        }
      }).error(function(err) {
        console.log(err);
      });
    }

    setInterval(countNotification, 5000);
    countNotification();

    // popover
    var popoverContent = 
      $navNotiBtn
        .siblings('.nav-noti-popover')
        .remove()
        .html()
        .trim();
    popoverContent = '<div class="nav-noti-popover">' + popoverContent + '</div>';

    $navNotiBtn.popover({
      html: true,
      content: popoverContent,
      placement: 'bottom',
    });
    $navNotiBtn.on('shown.bs.popover', function() {

      // noti-tab
      var $notiTab = $('a[data-toggle="tab"][href="#nav-tab-content-noti"]');
      var $notiContent = $('#nav-tab-content-noti');
      $notiTab.on('shown.bs.tab', function (e) {
        console.log(e.target) // activated tab
        // e.relatedTarget // previous tab
      });

      $notiTab.trigger('shown.bs.tab');
    });
  }); 
</script>
