<textarea
  id="<%- id %>"
  style="<%- locals.style || 'height:200px;' %>"
  hidden
><% if(locals.content) { %><%- content %><% } %></textarea>
<%- include(_v + '/component/uploader'); %>
<%- include_css('//cdn.bootcss.com/wangeditor/2.1.20/css/wangEditor.min.css') %>
<%- include_js('//cdn.bootcss.com/wangeditor/2.1.20/js/wangEditor.min.js') %>
<script>
$(document).ready(function() {

  var uploadInit = function() {
    var editor = this;
    var btnId = editor.customUploadBtnId;
    var urls = [];

    var uploader = new $['uploader-' + $.uploadConf.default]({
      browse_button: btnId,
      multi_selection: true,
      added: function (_uploader, files) {
        uploader.upload();
      },
      progress: function (percent) {
        editor.showUploadProgress(percent);
      },
      success: function (url) {
        urls.push(url);
      },
      complete: function (files) {
        try {
          $.each(urls, function (index, value) {
            editor.command(null, 'insertHtml', '<img src="' + value + '" style="max-width:100%;"/>');
          });
        } catch (ex) {
        } finally {
          urls = [];
          editor.hideUploadProgress();
        }
      }
    });
  }

  var editor = new wangEditor('<%- id %>');
  editor.config.customUpload = true;
  editor.config.customUploadInit = uploadInit;

  editor.config.menus = [
    'bold',
    '|',
    'link',
    'img',
    //'url_video',
    'insertcode',
    '|','source'
  ];
  editor.create();
  $('#<%- id %>').c(editor);
});
</script>
